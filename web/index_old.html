
<head><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <title>M68k Interpreter</title>
    <meta name="description" content="">
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-linedtextarea.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>
    <div class="container">
        <div class="page-header">
            <h1>M68k Interpreter Alpha</h1>
        </div>
        <div id="warnings-container" class="alert alert-warning" style="display: none;"></div>
        <div id="errors-container" class="alert alert-danger" style="display: none;">
            <p class="lead">OOPS! Your RISC-V Assembly code ran, but there were errors...</p>
            <div id="errors"></div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <p class="lead">Code</p>
                <div class="form-group">
                    <div class="linedwrap" style="width:720px"><div class="lines" style="width: 50px; height: 248px;"><div class="codelines"><div class="lineno">1</div><div class="lineno">2</div><div class="lineno">3</div><div class="lineno">4</div><div class="lineno">5</div><div class="lineno">6</div><div class="lineno">7</div><div class="lineno">8</div><div class="lineno">9</div><div class="lineno">10</div><div class="lineno">11</div><div class="lineno">12</div><div class="lineno">13</div><div class="lineno">14</div><div class="lineno">15</div><div class="lineno">16</div><div class="lineno">17</div></div></div><div class="linedtextarea"><textarea id="code" rows="15" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" wrap="off" style="resize: none; width: 646px;"></textarea></div></div>
                </div>
                <div class="btn-group btn-group-justified" role="group">
                    <div class="btn-group">
                        <button id="reset" class="btn btn-primary">Reset</button>
                    </div>
                    <div class="btn-group">
                        <button id="step" class="btn btn-warning">Step</button>
                    </div>
                    <div class="btn-group">
                        <button id="run" class="btn btn-success" onclick="go()">Run</button>
                    </div>
                    <div class="btn-group" style="display: none;">
                        <button id="stop" class="btn btn-danger">Stop</button>
                    </div>
                    <div class="btn-group">
                        <button id="freq" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            CPU: 32 Hz
                            <span class="caret"></span>
                        </button>
                        <!--- <ul class="dropdown-menu">
                            <li><a href="#" onclick="setFrequency(1);" data-proofer-ignore="">1 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(2);" data-proofer-ignore="">2 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(4);" data-proofer-ignore="">4 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(8);" data-proofer-ignore="">8 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(16);" data-proofer-ignore="">16 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(32);" data-proofer-ignore="">32 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(64);" data-proofer-ignore="">64 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(128);" data-proofer-ignore="">128 Hz</a></li>
                            <li><a href="#" onclick="setFrequency(256);" data-proofer-ignore="">256 Hz</a></li>
                        </ul>  -->
                    </div>
                </div>
                <br>
                <div id="recent-instruction" class="well">The most recent instructions will be shown here when stepping.</div>
                <hr>
                <h4>Features</h4>
                <ul>
                    <li><em>Reset</em> to load the code, <em>Step</em> one instruction, or <em>Run</em> all instructions</li>
                    <li>Set a breakpoint by clicking on the line number (only for <em>Run</em>)</li>
                    <li>View <a href="#register-table">registers</a> on the right, <a href="#memory-table">memory</a> on the bottom of this page</li>
                </ul>
                <h4>Supported Instructions</h4>
                <ul>
                    <li>Arithmetics: <code>ADD</code>, <code>ADDI</code>, <code>SUB</code></li>
                    <li>Logical: <code>AND</code>,<code>ANDI</code>,<code>OR</code>,<code>ORI</code>,<code> XOR</code>,<code>XORI</code></li>
                    <li>Sets: <code>SLT</code>, <code>SLTI</code>, <code>SLTU</code>, <code>SLTIU</code></li>
                    <li>Shifts: <code>SRA</code>, <code>SRAI</code>, <code>SRL</code>, <code>SRLI</code><code>SLL</code>, <code>SLLI</code></li>
            <li>Memory: <code>LW</code>, <code>SW</code>, <code>LB</code>, <code>SB</code></li>
            <li>PC: <code>LUI</code>, <code>AUIPC</code></li>
                    <li>Jumps: <code>JAL</code>, <code>JALR</code></li>
                    <li>Branches: <code>BEQ</code>, <code>BNE</code>,<code>BLT</code>, <code>BGE</code>, <code>BLTU</code>, <code>BGEU</code></li>
                </ul>
               <!-- <p>RISC-V Reference: <a href="https://content.riscv.org/wp-content/uploads/2017/05/riscv-spec-v2.2.pdf">riscv-spec-v2.2.pdf</a></p>-->
            </div>
            <div class="col-md-6">
                <div id="register-table" class="table-responsive">
                    <table class="table table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>Init Value</th>
                                <th>Register</th>
                                <th>Hex</th>
                            </tr>
                        </thead>
                        <tbody id="registers">
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a0</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a1</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a2</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a3</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a4</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a5</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a6</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>a7</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d0</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d1</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d2</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d3</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d4</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d5</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d6</td><td>0</td>
                            <tr><td><input class="init-value" type="text" value="0"></td><td>d7</td><td>0</td>
                        </tbody>
                    </table>
                    <button id="register-download" class="btn btn-primary">Download Registers!</button>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-12">
                <div class="form-inline text-center">
                    <div class="form-group">
                        <label for="memory-address">Memory Address</label>
                        <input type="text" id="memory-address" class="form-control" placeholder="0x00000000" value="0x00000000">
                    </div>
                    <button id="memory-go" class="btn btn-primary">Go</button>
                    <button id="memory-download" class="btn btn-primary">Download!</button>
                </div>
                <br>
                <div id="memory-table" class="table-responsive">
                    <table class="table table-hover table-condensed">
                        <thead>
                            <tr>
                                <th>Memory Address</th>
                                <th>Decimal</th>
                                <th>Hex</th>
                                <th>Binary</th>
                            </tr>
                        </thead>
                        <tbody id="memory">
                            <tr><td>0x00000000</td><td>0</td>
                            <tr><td>0x00000004</td><td>0</td>
                            <tr><td>0x00000008</td><td>0</td>
                            <tr><td>0x0000000c</td><td>0</td>
                            <tr><td>0x00000010</td><td>0</td>
                            <tr><td>0x00000014</td><td>0</td>
                            <tr><td>0x00000018</td><td>0</td>
                            <tr><td>0x0000001c</td><td>0</td>
                            <tr><td>0x00000020</td><td>0</td>
                            <tr><td>0x00000024</td><td>0</td>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/sprintf.js"></script>
    <script type="text/javascript" src="js/memory.js"></script>
    <script type="text/javascript" src="js/utilities.js"></script>
    <script type="text/javascript" src="js/operations.js"></script>  
    <script type="text/javascript" src="js/emulator.js"></script>    
    <script type="text/javascript">
        function go() {
            var code = document.getElementById('code').value;
            

            globalP = new Emulator(code);

            var registers = new Int32Array(16);
            registers = globalP.getRegisters();
            var HTMLRegistri = sprintf("<tr><td>%d</td><td>a%d</td><td>0x%08x</td>", registers[0], 0, registers[0] >>> 0);

            for(i = 1; i < 8; i++) {
                HTMLRegistri += sprintf("<tr><td>%d</td><td>a%d</td><td>0x%08x</td>", registers[i], i, registers[i] >>> 0);
            }

            HTMLRegistri += sprintf("<tr><td>%d</td><td>d%d</td><td>0x%08x</td>", registers[8], 0, registers[8] >>> 0);

            for(i = 9; i < 16; i++) {
                HTMLRegistri += sprintf("<tr><td>%d</td><td>d%d</td><td>0x%08x</td>", registers[i], i - 8, registers[i] >>> 0);
            }

            document.getElementById('registers').innerHTML = HTMLRegistri;

            
           
        }
        
    </script>
</body>
